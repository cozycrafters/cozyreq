[tools]
bun = "latest"
"github:supabase/cli" = "latest"
uv = "latest"
rust = "latest"

[settings]
python.uv_venv_auto = true

[env]
_.file = '.env'
OPENCODE_EXPERIMENTAL_OXFMT = "true"

[tasks.dev]
description = "Start all services (Supabase + API + web) in parallel"
depends = ["db:start", "dev:api", "dev:web"]

[tasks."dev:web"]
description = "Start Next.js dev server only"
run = "bun run dev"
dir = "apps/web"

[tasks."dev:api"]
description = "Start FastAPI dev server only"
run = "fastapi dev src/main.py"
dir = "apps/api"

[tasks."dev:cli"]
description = "Build and run CLI in dev mode"
run = "cargo run"
dir = "apps/cli"

[tasks."db:start"]
description = "Start Supabase local stack"
run = "supabase start"

[tasks."db:stop"]
description = "Stop Supabase"
run = "supabase stop"

[tasks."db:reset"]
description = "Reset Supabase (useful for testing)"
run = "supabase db reset"

[tasks.test]
description = "Run all test suites (bun test + uv run test + cargo test)"
run = """
bun run test
pytest
cargo test
"""

[tasks.lint]
description = "Run all linters: oxlint, ruff, clippy"
run = """
bun run lint
ruff check
cargo lint
"""

[tasks.format]
description = "Run all formatters: oxfmt, ruff, rustfmt"
run = """
bun run fmt
ruff format
cargo format
"""
